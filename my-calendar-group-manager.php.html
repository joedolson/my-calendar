<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: my-calendar-group-manager.php - My Calendar Hook Doumentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles-docs.css?v=0.1.1">
</head>

<body>

<div id="main">

    <header><h1 class="page-title">Source: my-calendar-group-manager.php</h1></header>
	<main>
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;?php
/**
 * Manage My Calendar events groups
 *
 * @category Events
 * @package  My Calendar
 * @author   Joe Dolson
 * @license  GPLv2 or later
 * @link     https://www.joedolson.com/my-calendar/
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Generate the Grouped event editing form
 */
function my_calendar_group_edit() {
	global $wpdb;
	// First some quick cleaning up.
	$action   = ! empty( $_POST['event_action'] ) ? sanitize_text_field( $_POST['event_action'] ) : '';
	$event_id = ! empty( $_POST['event_id'] ) ? (int) $_POST['event_id'] : '';
	$group_id = ! empty( $_POST['group_id'] ) ? (int) $_POST['group_id'] : '';

	if ( isset( $_GET['mode'] ) ) {
		if ( 'edit' === $_GET['mode'] ) {
			$action   = 'edit';
			$event_id = (int) $_GET['event_id'];
			$group_id = (int) $_GET['group_id'];
		}
	}

	if ( isset( $_POST['event_action'] ) ) {
		global $mc_output;
		$nonce = $_REQUEST['_wpnonce'];
		if ( ! wp_verify_nonce( $nonce, 'my-calendar-nonce' ) ) {
			wp_die( 'My Calendar: Security check failed' );
		}
		$message = '';
		switch ( $_POST['event_action'] ) {
			case 'edit':
				if ( isset( $_POST['apply'] ) &amp;&amp; is_array( $_POST['apply'] ) ) {
					$post      = map_deep( $_POST, 'wp_kses_post' );
					$mc_output = mc_check_group_data( $action, $post );
					foreach ( $post['apply'] as $event_id ) {
						$event_id = absint( $event_id );
						$response = my_calendar_save_group( $action, $mc_output, $event_id, $post );
						echo $response;
					}
				}
				break;
			case 'break':
				$events = map_deep( $_POST['break'], 'absint' );
				foreach ( $events as $event_id ) {
					$update  = array( 'event_group_id' => 0 );
					$formats = array( '%d' );
					$result  = $wpdb->update( my_calendar_table(), $update, array( 'event_id' => $event_id ), $formats, '%d' );
					// Translators: Calendar URL.
					$url = sprintf( __( 'View &lt;a href="%s">your calendar&lt;/a>.', 'my-calendar' ), mc_get_uri() );
					if ( false === $result ) {
						$message = mc_show_error( __( 'Event not updated.', 'my-calendar' ) . " $url", false );
					} elseif ( 0 === $result ) {
						$message = mc_show_notice( "#$event_id: " . __( 'Nothing was changed in that update.', 'my-calendar' ) . "  $url", false );
					} else {
						$message = mc_show_notice( "#$event_id: " . __( 'Event updated successfully', 'my-calendar' ) . ". $url", false );
					}
				}
				break;
			case 'group':
				if ( isset( $_POST['group'] ) &amp;&amp; is_array( $_POST['group'] ) ) {
					$events = map_deep( $_POST['group'], 'absint' );
					sort( $events );
					foreach ( $events as $event_id ) {
						$group_id = $events[0];
						$update   = array( 'event_group_id' => $group_id );
						$formats  = array( '%d' );
						$result   = $wpdb->update( my_calendar_table(), $update, array( 'event_id' => $event_id ), $formats, '%d' );

						if ( false === $result ) {
							$message = mc_show_error( __( 'Event not grouped.', 'my-calendar' ), false );
						} elseif ( 0 === $result ) {
							$message = mc_show_notice( "#$event_id: " . __( 'Nothing was changed in that update.', 'my-calendar' ), false );
						} else {
							// Translators: Event group ID.
							$message = mc_show_notice( sprintf( __( 'Group %s: Events grouped successfully', 'my-calendar' ), "#$event_id" ), false );
						}
					}
				}
				break;
		}
		echo $message;
	}
	?>

	&lt;div class="wrap my-calendar-admin" id="my-calendar">
	&lt;?php
	my_calendar_check_db();
	if ( 'edit' === $action ) {
		echo '&lt;h1>' . __( 'Edit Event Group', 'my-calendar' ) . '&lt;/h1>';
		if ( empty( $event_id ) || empty( $group_id ) ) {
			mc_show_error( __( 'You must provide an event group id in order to edit it', 'my-calendar' ) );
		} else {
			mc_edit_groups( 'edit', $event_id, $group_id );
		}
	} else {
		?>
		&lt;h1>&lt;?php esc_html_e( 'Event Groups', 'my-calendar' ); ?>&lt;/h1>
		&lt;p>
			&lt;?php _e( 'When you choose a group of events to edit, the form will be pre-filled with the content from the event you choose.', 'my-calendar' ); ?>
		&lt;/p>
		&lt;div class="mc-tablinks">
			&lt;a href="&lt;?php echo admin_url( 'admin.php?page=my-calendar-manage' ); ?>">&lt;?php esc_html_e( 'My Events', 'my-calendar' ); ?>&lt;/strong>
			&lt;a href="#my-calendar-admin-table" aria-current="page">&lt;?php esc_html_e( 'Event Groups', 'my-calendar' ); ?>&lt;/a>
		&lt;/div>
		&lt;div class="postbox-container jcd-wide">
			&lt;div class="metabox-holder">
				&lt;div class="ui-sortable meta-box-sortables">
					&lt;div class="postbox">
						&lt;h2>&lt;?php esc_html_e( 'Event Groups', 'my-calendar' ); ?>&lt;/h2>
						&lt;?php mc_list_groups(); ?>
					&lt;/div>
				&lt;/div>
			&lt;/div>
		&lt;/div>
		&lt;?php
	}
	mc_show_sidebar();
	?>
	&lt;/div>
	&lt;?php
}

/**
 * Save data within a group of events.
 *
 * @param string $action Type of action: add, edit.
 * @param array  $output Data and status of data check.
 * @param int    $event_id Event ID.
 * @param array  $post POST data.
 *
 * @return string message
 */
function my_calendar_save_group( $action, $output, $event_id, $post = array() ) {
	global $wpdb, $event_author;
	$proceed = $output[0];
	$message = '';

	if ( 'edit' === $action &amp;&amp; true === $proceed ) {
		$event_author = (int) ( $_POST['event_author'] );
		if ( mc_can_edit_event( $event_id ) ) {
			$update = $output[2];
			$cats   = $update['event_categories'];
			unset( $update['event_categories'] );
			mc_update_category_relationships( $cats, $event_id );

			/**
			 * Filter calendar update data before saving an individual event when managing groups.
			 *
			 * @hook mc_update_group_data
			 *
			 * @param {array} $update Event update data for groups.
			 * @param {string} $event_author Author for these events.
			 * @param {string} $action Action performed.
			 * @param {int}    $event_id Event ID being updated.
			 *
			 * @return {array}
			 */
			$update  = apply_filters( 'mc_update_group_data', $update, $event_author, $action, $event_id );
			$formats = array( '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%d', '%d', '%d', '%d', '%f', '%f' );

			$result = $wpdb->update( my_calendar_table(), $update, array( 'event_id' => $event_id ), $formats, '%d' );

			$edit_url = '&lt;a href="' . admin_url( "admin.php?page=my-calendar&amp;amp;mode=edit&amp;amp;event_id=$event_id" ) . '" class="button-secondary">' . __( 'Edit Event', 'my-calendar' ) . '&lt;/a>';
			$view_url = ' &lt;a href="' . mc_get_details_link( mc_get_first_event( $event_id ) ) . '" class="button-secondary">' . __( 'View Event', 'my-calendar' ) . '&lt;/a>';
			$url      = $edit_url . $view_url;
			// Make sure POST data is available in update array.
			$update = array_merge( $update, $post );
			// Same as action on basic save.
			mc_event_post( 'edit', $update, $event_id, $result );
			/**
			 * Run action when an event is saved.
			 *
			 * @hook mc_save_event
			 *
			 * @param {string}    $action Current action: edit, copy, add.
			 * @param {array}     $update Data updated.
			 * @param {int}       $event_id Event ID.
			 * @param {int|false} $result Result of the DB update query.
			 */
			do_action( 'mc_save_event', 'edit', $update, $event_id, $result );
			/**
			 * Run action when a group of events are saved.
			 *
			 * @hook mc_save_grouped_events
			 *
			 * @param {int|false} $result Current action: edit, copy, add.
			 * @param {int}       $event_id Event ID.
			 * @param {array} $update Updated data.
			 */
			do_action( 'mc_save_grouped_events', $result, $event_id, $update );
			if ( false === $result ) {
				$message = mc_show_error( "#$event_id; " . __( 'Your event was not updated.', 'my-calendar' ) . " $url", false );
			} elseif ( 0 === $result ) {
				$message = mc_show_notice( "#$event_id: " . __( 'Nothing was changed in that update.', 'my-calendar' ) . " $url", false );
			} else {
				$message = mc_show_notice( "#$event_id: " . __( 'Event updated successfully', 'my-calendar' ) . ". $url", false );
			}
		} else {
			$message = mc_show_error( "#$event_id: " . __( 'You do not have sufficient permissions to edit that event.', 'my-calendar' ), false );
		}
	}
	$message = $message . "\n" . $output[3];

	return $message;
}

/**
 * Compare events within a group to see if they currently have the same information.
 *
 * @param int          $group_id Group ID.
 * @param string|false $field Column name of field to compare. False to check all grouped fields.
 * @param bool         $echo False to return if single field comparison.
 *
 * @return string|boolean True if information is the same for multiple fields; string for single field checks.
 */
function mc_compare_group_members( $group_id, $field = false, $echo = true ) {
	global $wpdb;
	if ( ! $field ) {
		$query = 'SELECT event_title, event_desc, event_short, event_link, event_label, event_street, event_street2, event_city, event_state, event_postcode, event_region, event_country, event_url, event_image, event_category, event_link_expires, event_zoom, event_phone, event_host, event_longitude, event_latitude FROM ' . my_calendar_table() . ' WHERE event_group_id = %d';
	} else {
		// Just comparing a single field.
		$query = "SELECT $field FROM " . my_calendar_table() . ' WHERE event_group_id = %d';
	}
	$results = $wpdb->get_results( $wpdb->prepare( $query, $group_id ), ARRAY_N ); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared
	$count   = count( $results );
	for ( $i = 0; $i &lt; $count; $i ++ ) {
		$n = ( ( $i + 1 ) > $count - 1 ) ? 0 : $i + 1;
		if ( md5( implode( '', $results[ $i ] ) ) !== md5( implode( '', $results[ $n ] ) ) ) {
			if ( $field ) {
				$message = ' &lt;span class="nomatch">' . __( 'Fields do not match', 'my-calendar' ) . '&lt;/span>';
				if ( $echo ) {
					echo wp_kses_post( $message );
				} else {
					return $message;
				}
			} else {
				return false;
			}
		}
	}

	return true;
}

/**
 * Show members of group and provide options to select which to edit.
 *
 * @param int    $group_id Group ID.
 * @param string $type Context of form.
 *
 * @return string form
 */
function mc_group_form( $group_id, $type = 'break' ) {
	$event_id = (int) $_GET['event_id'];
	$nonce    = wp_create_nonce( 'my-calendar-nonce' );
	$results  = mc_get_grouped_events( $group_id );
	if ( 'apply' === $type ) {
		$warning = ( ! mc_compare_group_members( $group_id ) ) ? '&lt;p class="unmatched warning">' . __( '&lt;strong>Warning:&lt;/strong> Editable fields for the events in this group do not match.', 'my-calendar' ) . '&lt;/p>' : '&lt;p class="matched">' . __( 'Editable fields for the events in this group match.', 'my-calendar' ) . '&lt;/p>';
	} else {
		$warning = '';
	}
	$class   = ( 'break' === $type ) ? 'break' : 'apply';
	$group   = "&lt;div class='group mc-actions $class'>";
	$group  .= $warning;
	$group  .= ( 'apply' === $type ) ? '&lt;fieldset>&lt;legend>' . __( 'Apply changes to:', 'my-calendar' ) . '&lt;/legend>' : '';
	$group  .= ( 'break' === $type ) ? "&lt;form method='post' action='" . admin_url( "admin.php?page=my-calendar-manage&amp;groups=true&amp;amp;mode=edit&amp;amp;event_id=$event_id&amp;amp;group_id=$group_id" ) . "'>
	&lt;div>&lt;input type='hidden' value='" . esc_attr( $group_id ) . "' name='group_id' />&lt;input type='hidden' value='" . esc_attr( $type ) . "' name='event_action' />&lt;input type='hidden' name='_wpnonce' value='$nonce' />
	&lt;/div>" : '';
	$group  .= "&lt;ul class='checkboxes'>";
	$checked = ( 'apply' === $type ) ? ' checked="checked"' : '';
	foreach ( $results as $result ) {
		$first = mc_get_first_event( $result->event_id );
		if ( ! is_object( $first ) ) {
			continue;
		}
		$date   = date_i18n( 'D, j M, Y', $first->ts_occur_begin );
		$time   = date_i18n( 'g:i a', $first->ts_occur_begin );
		$title  = esc_html( stripslashes( $first->event_title ) );
		$group .= "&lt;li>&lt;input type='checkbox' name='$type" . "[]' value='$first->event_id' id='$type$first->event_id'$checked /> &lt;label for='break$first->event_id'>$title&lt;br />$date, $time&lt;/label>&lt;/li>\n";
	}
	$group .= "&lt;li>&lt;input type='checkbox' class='selectall' data-action='$type' id='$type'$checked /> &lt;label for='$type'>&lt;b>" . __( 'Check/Uncheck all', 'my-calendar' ) . "&lt;/b>&lt;/label>&lt;/li>\n&lt;/ul>";
	$group .= ( 'apply' === $type ) ? '&lt;/fieldset>' : '';
	$group .= ( 'break' === $type ) ? "&lt;p>&lt;input type='submit' class='button' value='" . __( 'Remove checked events from this group', 'my-calendar' ) . "' />&lt;/p>&lt;/form>" : '';
	$group .= '&lt;/div>';

	return $group;
}

/**
 * The event edit form for the manage events admin page
 *
 * @param string $mode Editing mode.
 * @param int    $event_id Event ID.
 * @param int    $group_id Group ID.
 */
function mc_edit_groups( $mode = 'edit', $event_id = 0, $group_id = 0 ) {
	global $submission;
	$event_id = ( 0 === $event_id ) ? false : $event_id;
	$group_id = ( 0 === $group_id ) ? false : $group_id;
	$message  = '';
	$group    = '';
	$data     = mc_form_data( $event_id );

	if ( false !== $group_id ) {
		$group = mc_group_form( $group_id, 'break' );
	} else {
		$message .= __( 'You must provide a group ID to edit groups', 'my-calendar' );
	}
	mc_show_error( $message );
	echo wp_kses( $group, mc_kses_elements() );

	my_calendar_print_group_fields( $data, $mode, $event_id );
}

/**
 * Generate form to edit group editable fields.
 *
 * @param object $data Event object data.
 * @param string $mode Editing mode.
 * @param int    $event_id Event ID.
 */
function my_calendar_print_group_fields( $data, $mode, $event_id ) {
	global $user_ID;
	$has_data    = ( is_object( $data ) ) ? true : false;
	$user        = get_userdata( $user_ID );
	$group_id    = ( ! empty( $data->event_group_id ) ) ? $data->event_group_id : mc_group_id();
	$title       = '';
	$description = '';
	$short       = '';
	$image       = '';

	if ( is_object( $data ) ) {
		$title       = stripslashes( $data->event_title );
		$description = stripslashes( $data->event_desc );
		$short       = stripslashes( $data->event_short );
		$image       = $data->event_image;
	}
	?>
	&lt;div class="postbox-container jcd-wide">
	&lt;div class="metabox-holder">
	&lt;form method="post" action="&lt;?php echo admin_url( "admin.php?page=my-calendar-manage&amp;groups=true&amp;amp;mode=edit&amp;amp;event_id=$event_id&amp;amp;group_id=$group_id" ); ?>">
	&lt;div>
		&lt;input type="hidden" name="_wpnonce" value="&lt;?php echo wp_create_nonce( 'my-calendar-nonce' ); ?>" />
		&lt;input type="hidden" name="group_id" value="&lt;?php echo absint( $group_id ); ?>" />
		&lt;input type="hidden" name="event_action" value="&lt;?php echo esc_attr( $mode ); ?>" />
		&lt;input type="hidden" name="event_id" value="&lt;?php echo absint( $event_id ); ?>" />
		&lt;input type="hidden" name="event_author" value="&lt;?php echo absint( $user_ID ); ?>" />
		&lt;input type="hidden" name="event_post" value="group" />
		&lt;input type="hidden" name="event_nonce_name" value="&lt;?php echo wp_create_nonce( 'event_nonce' ); ?>" />
	&lt;/div>
	&lt;div class="ui-sortable meta-box-sortables">
		&lt;div class="postbox">
			&lt;h2>&lt;?php esc_html_e( 'Manage Event Groups', 'my-calendar' ); ?>&lt;/h2>

			&lt;div class="inside">
				&lt;div class="mc-controls">
					&lt;ul>
						&lt;li>
						&lt;?php
						$manage_text = __( 'Manage groups', 'my-calendar' );
						echo "&lt;span class='dashicons dashicons-calendar' aria-hidden='true'>&lt;/span>" . '&lt;a href="' . admin_url( 'admin.php?page=my-calendar-manage&amp;groups=true' ) . '">' . $manage_text . '&lt;/a>';
						?>
						&lt;/li>
						&lt;li>&lt;input type="submit" name="save" class="button-primary" value="&lt;?php _e( 'Update Event Group', 'my-calendar' ); ?>"/>&lt;/li>
					&lt;/ul>
				&lt;/div>
				&lt;p>
					&lt;label for="e_title">&lt;?php esc_html_e( 'Event Title', 'my-calendar' ); ?> &lt;span>&lt;?php esc_html_e( '(required)', 'my-calendar' ); ?>&lt;/span>
					&lt;?php mc_compare_group_members( $group_id, 'event_title' ); ?>
					&lt;/label>&lt;br/>
					&lt;input type="text" id="e_title" class="widefat" name="event_title" value="&lt;?php echo esc_attr( $title ); ?>" />
				&lt;/p>
				&lt;?php
				echo mc_group_form( $group_id, 'apply' );

				if ( '0' === $data->event_repeats &amp;&amp; ( 'S1' === $data->event_recur || 'S' === $data->event_recur ) ) {
					$span_checked = '';
					if ( is_object( $data ) &amp;&amp; '1' === $data->event_span ) {
						$span_checked = ' checked="checked"';
					} elseif ( is_object( $data ) &amp;&amp; '0' === $data->event_span ) {
						$span_checked = '';
					}
					?>
					&lt;p>
						&lt;input type="checkbox" value="1" id="e_span" name="event_span" &lt;?php echo $span_checked; ?> />
						&lt;label for="e_span">
						&lt;?php
						_e( 'Selected dates are a single multi-day event.', 'my-calendar' );
						mc_compare_group_members( $group_id, 'event_span' );
						?>
						&lt;/label>
					&lt;/p>
					&lt;?php
				} else {
					?>
					&lt;div>&lt;input type='hidden' name='event_span' value='&lt;?php echo esc_attr( $data->event_span ); ?>' />&lt;/div>
					&lt;?php
				}
				if ( mc_show_edit_block( 'event_desc' ) ) {
					?>
					&lt;div id="group_description">
						&lt;label for="content">
						&lt;?php
						_e( 'Event Description', 'my-calendar' );
						mc_compare_group_members( $group_id, 'event_desc' );
						?>
						&lt;/label>&lt;br/>
						&lt;?php wp_editor( $description, 'content', array( 'textarea_rows' => 10 ) ); ?>
					&lt;/div>
					&lt;?php
				}
				if ( mc_show_edit_block( 'event_short' ) ) {
					?>
					&lt;p>
						&lt;label for="e_short">
						&lt;?php
						_e( 'Excerpt', 'my-calendar' );
						mc_compare_group_members( $group_id, 'event_short' );
						?>
						&lt;/label>&lt;br/>
						&lt;textarea id="e_short" name="event_short" rows="2" cols="80">&lt;?php echo esc_textarea( stripslashes( $short ) ); ?>&lt;/textarea>
					&lt;/p>
					&lt;?php
				}
				if ( mc_show_edit_block( 'event_category' ) ) {
					$match        = mc_compare_group_members( $group_id, 'event_category', false );
					$select       = mc_category_select( $data, true, false );
					$add_category = current_user_can( 'mc_edit_cats' ) ? '&lt;input class="mc-srt" type="checkbox" name="event_category_new" id="event_category_new" value="true" /> &lt;label for="event_category_new" class="button">&lt;span class="dashicons dashicons-plus" aria-hidden="true">&lt;/span>' . __( 'Add Categories', 'my-calendar' ) . '&lt;/label>' : '';
					$addnew       = '&lt;div class="new-event-category">
					&lt;p>&lt;label for="event_category_name">' . __( 'Category Name', 'my-calendar' ) . '&lt;/label> &lt;input type="text" value="" id="event_category_name" name="event_category_name" disabled /> &lt;button type="button" class="button add-category">' . __( 'Add Category', 'my-calendar' ) . '&lt;/button>&lt;/p>
				&lt;/div>';
					$return       = '&lt;fieldset class="categories">&lt;legend>' . __( 'Categories', 'my-calendar' ) . $match . '&lt;/legend>&lt;ul class="checkboxes">' . mc_category_select( $data, true, true ) . '&lt;li class="event-new-category"> ' . $add_category . '&lt;/li>&lt;/ul>&lt;/fieldset>' . $addnew . '&lt;p class="mc-primary-category">&lt;label for="event_category">' . __( 'Primary Category', 'my-calendar' ) . '&lt;/label>&lt;select name="primary_category" id="e_category">' . $select . '&lt;/select>&lt;/p>';
					echo wp_kses( $return, mc_kses_elements() );
				} else {
					?>
					&lt;div>
						&lt;input type="hidden" name="event_category" value="1" />
					&lt;/div>
					&lt;?php
				}
				?>
					&lt;/div>
				&lt;/div>
			&lt;/div>
			&lt;div class="ui-sortable meta-box-sortables">
				&lt;div class="postbox">
					&lt;h2>&lt;?php esc_html_e( 'Featured Image', 'my-calendar' ); ?>&lt;/h2>
					&lt;div class="inside">
					&lt;?php
					if ( mc_show_edit_block( 'event_image' ) ) {
						?>
						&lt;div class='mc-image-upload field-holder'>
							&lt;div class="image_fields">
							&lt;?php
							mc_compare_group_members( $group_id, 'event_image' );
							if ( $has_data &amp;&amp; property_exists( $data, 'event_post' ) ) {
								$image    = ( has_post_thumbnail( $data->event_post ) ) ? get_the_post_thumbnail_url( $data->event_post ) : $data->event_image;
								$image_id = ( has_post_thumbnail( $data->event_post ) ) ? get_post_thumbnail_id( $data->event_post ) : '';
							} else {
								$image    = ( $has_data &amp;&amp; '' !== $data->event_image ) ? $data->event_image : '';
								$image_id = '';
							}
							$button_text = __( 'Select Featured Image', 'my-calendar' );
							$remove      = '';
							$alt         = '';
							if ( '' !== $image ) {
								$alt         = ( $image_id ) ? get_post_meta( $image_id, '_wp_attachment_image_alt', true ) : '';
								$remove      = '&lt;button type="button" class="button remove-image" aria-describedby="event_image">' . esc_html__( 'Remove Featured Image', 'my-calendar' ) . '&lt;/button>';
								$button_text = __( 'Change Featured Image', 'my-calendar' );
								$image_desc  = ( '' === $alt ) ? $data->event_image : $alt;
							}
							?>
							&lt;input type="hidden" name="event_image_id" value="&lt;?php echo esc_attr( $image_id ); ?>" class="textfield" id="e_image_id" />&lt;input type="hidden" name="event_image" id="e_image" value="&lt;?php echo esc_url( $image ); ?>" /> &lt;button type='button' class="button select-image">&lt;?php echo $button_text; ?>&lt;/button> &lt;?php echo $remove; ?>
							&lt;/div>
							&lt;?php
							if ( ! empty( $data->event_image ) ) {
								echo '&lt;div class="event_image" aria-live="assertive">&lt;img id="event_image" src="' . esc_url( $image ) . '" alt="' . __( 'Current image: ', 'my-calendar' ) . esc_attr( $alt ) . '" />&lt;/div>';
							} else {
								echo '&lt;div class="event_image">&lt;/div>';
							}
							?>
						&lt;/div>
					&lt;/div>
				&lt;/div>
			&lt;/div>
						&lt;?php
					} else {
						?>
						&lt;div>
							&lt;input type="hidden" name="event_image" value="&lt;?php echo ( $has_data ) ? esc_attr( $data->event_image ) : ''; ?>" />
							&lt;?php
							if ( ! empty( $data->event_image ) ) {
								echo '&lt;div class="event_image">&lt;img src="' . esc_attr( $data->event_image ) . '" alt="" />&lt;/div>';
							}
							?>
						&lt;/div>
						&lt;?php
					}
					?>
			&lt;div class="ui-sortable meta-box-sortables">
				&lt;div class="postbox">
					&lt;h2>&lt;?php esc_html_e( 'Event Details', 'my-calendar' ); ?>&lt;/h2>
					&lt;div class="inside">
					&lt;p>
						&lt;label for="e_host">
						&lt;?php
						_e( 'Event Host', 'my-calendar' );
						mc_compare_group_members( $group_id, 'event_host' );
						?>
						&lt;/label>
						&lt;select id="e_host" name="event_host">
							&lt;?php
							// Grab hosts and list them.
							$user_list = mc_get_users( 'hosts' );
							foreach ( $user_list as $u ) {
								echo '&lt;option value="' . $u->ID . '"';
								if ( is_object( $data ) &amp;&amp; absint( $data->event_host ) === absint( $u->ID ) ) {
									echo ' selected="selected"';
								} elseif ( is_object( $u ) &amp;&amp; $u->ID === $user->ID &amp;&amp; empty( $data->event_host ) ) {
									echo ' selected="selected"';
								}
								$display_name = ( '' === $u->display_name ) ? $u->user_nicename : $u->display_name;
								echo ">$display_name&lt;/option>\n";
							}
							?>
						&lt;/select>
					&lt;/p>
					&lt;?php
					if ( mc_show_edit_block( 'event_link' ) ) {
						$exp_checked = '';
						if ( is_object( $data ) &amp;&amp; '1' === $data->event_link_expires ) {
							$exp_checked = ' checked="checked"';
						} elseif ( is_object( $data ) &amp;&amp; '0' === $data->event_link_expires ) {
							$exp_checked = '';
						} elseif ( mc_event_link_expires() ) {
							$exp_checked = ' checked="checked"';
						}
						?>
						&lt;p>
							&lt;label for="e_link">
							&lt;?php
							_e( 'Event Link (Optional)', 'my-calendar' );
							mc_compare_group_members( $group_id, 'event_link' );
							?>
							&lt;/label>
							&lt;input type="text" placeholder="https://" id="e_link" name="event_link" size="40" value="&lt;?php echo ( is_object( $data ) ) ? esc_url( $data->event_link ) : ''; ?>" />
							&lt;input type="checkbox" value="1" id="e_link_expires" name="event_link_expires"&lt;?php echo $exp_checked; ?> />
							&lt;label for="e_link_expires">&lt;?php esc_html_e( 'Link will expire after event.', 'my-calendar' ); ?>&lt;/label>
						&lt;/p>
						&lt;?php
					}
					?>
				&lt;/div>
			&lt;/div>
		&lt;/div>
	&lt;?php
	/**
	 * Filter event registration fields.
	 *
	 * @hook mc_event_registration
	 *
	 * @param {string} $event_registration_output HTML output. Default empty.
	 * @param {bool}   $has_data Whether this event has data.
	 * @param {object} $data Event data object.
	 * @param {string} $context Indicates this is running in the admin.
	 *
	 * @return {string}
	 */
	$event_registration_output = apply_filters( 'mc_event_registration', '', $has_data, $data, 'admin' );
	if ( mc_show_edit_block( 'event_open' ) &amp;&amp; '' !== $event_registration_output ) {
		?>
		&lt;div class="ui-sortable meta-box-sortables">
			&lt;div class="postbox">
				&lt;h2>&lt;?php esc_html_e( 'Registration Settings', 'my-calendar' ); ?>&lt;/h2>

				&lt;div class="inside">
					&lt;fieldset>
						&lt;legend>&lt;?php esc_html_e( 'Event Registration Status', 'my-calendar' ); ?>&lt;/legend>
						&lt;?php echo $event_registration_output; ?>
					&lt;/fieldset>
				&lt;/div>
			&lt;/div>
		&lt;/div>
		&lt;?php
	} else {
		?>
	&lt;div>
		&lt;input type="hidden" name="event_tickets" value="&lt;?php echo ( $has_data ) ? esc_attr( $data->event_tickets ) : ''; ?>"/>
		&lt;input type="hidden" name="event_registration" value="&lt;?php echo ( $has_data ) ? esc_attr( $data->event_registration ) : ''; ?>"/>
	&lt;/div>
		&lt;?php
	}
	if ( mc_show_edit_block( 'event_location' ) ) {
		?>
	&lt;div class="ui-sortable meta-box-sortables">
		&lt;div class="postbox">
			&lt;h2>&lt;?php esc_html_e( 'Event Location', 'my-calendar' ); ?>&lt;/h2>

			&lt;div class="inside location_form">
				&lt;fieldset>
					&lt;legend class="screen-reader-text">&lt;?php esc_html_e( 'Event Location', 'my-calendar' ); ?>&lt;/legend>
		&lt;?php
		echo mc_event_location_dropdown_block( $data );
		mc_show_block( 'event_location', $has_data, $data, true, '', $group_id );
		?>
				&lt;/fieldset>
			&lt;/div>
		&lt;/div>
	&lt;/div>
		&lt;?php
	}
	?>
	&lt;/form>
	&lt;/div>
	&lt;/div>
	&lt;?php
}

/**
 * Check data to be submitted to save
 *
 * @param string $action Type of action.
 * @param array  $post of event data.
 *
 * @return mixed array/object $data checked array or object if error found
 */
function mc_check_group_data( $action, $post ) {
	/**
	 * Filter posted event group data prior to running event data checks.
	 *
	 * @hook mc_groups_pre_checkdata
	 *
	 * @param {array}  $post POST data.
	 * @param {string} $action Type of action running.(add, edit, or copy.)
	 *
	 * @return {array}
	 */
	$post = apply_filters( 'mc_groups_pre_checkdata', $post, $action );
	global $wpdb, $current_user, $submission;

	$url_ok   = 0;
	$title_ok = 0;
	$submit   = array();
	if ( version_compare( PHP_VERSION, '7.4', '&lt;' ) &amp;&amp; get_magic_quotes_gpc() ) { //phpcs:ignore PHPCompatibility.FunctionUse.RemovedFunctions.get_magic_quotes_gpcDeprecated
		$post = array_map( 'stripslashes_deep', $post );
	}
	if ( ! wp_verify_nonce( $post['event_nonce_name'], 'event_nonce' ) ) {
		return '';
	}
	$errors = '';
	if ( 'add' === $action || 'edit' === $action || 'copy' === $action ) {
		$title   = ! empty( $post['event_title'] ) ? trim( $post['event_title'] ) : '';
		$desc    = ! empty( $post['content'] ) ? trim( $post['content'] ) : '';
		$short   = ! empty( $post['event_short'] ) ? trim( $post['event_short'] ) : '';
		$host    = ! empty( $post['event_host'] ) ? $post['event_host'] : $current_user->ID;
		$cats    = array();
		$primary = 1;
		if ( isset( $post['event_category'] ) ) {
			$cats = $post['event_category'];
			if ( is_array( $cats ) &amp;&amp; ! empty( $cats ) ) {
				// Set first category as primary.
				$primary = ( is_numeric( $cats[0] ) ) ? $cats[0] : 1;
				foreach ( $cats as $cat ) {
					$private = mc_get_category_detail( $cat, 'category_private' );
					// If a selected category is private, set that category as primary instead.
					if ( 1 === (int) $private ) {
						$primary = $cat;
					}
				}
			} else {
				$primary = $post['event_category'];
				$cats    = array( $cats );
			}
		}

		$event_link         = ! empty( $post['event_link'] ) ? trim( $post['event_link'] ) : '';
		$expires            = ! empty( $post['event_link_expires'] ) ? $post['event_link_expires'] : '0';
		$location_preset    = ! empty( $post['location_preset'] ) ? $post['location_preset'] : '';
		$event_tickets      = ! empty( $post['event_tickets'] ) ? trim( $post['event_tickets'] ) : '';
		$event_registration = ! empty( $post['event_registration'] ) ? trim( $post['event_registration'] ) : '';
		$event_image        = esc_url_raw( $post['event_image'] );
		$event_span         = ! empty( $post['event_span'] ) ? 1 : 0;
		// Set location.
		if ( 'none' !== $location_preset ) {
			$location        = $wpdb->get_row( $wpdb->prepare( 'SELECT * FROM ' . my_calendar_locations_table() . ' WHERE location_id = %d', $location_preset ) ); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared
			$event_label     = $location->location_label;
			$event_street    = $location->location_street;
			$event_street2   = $location->location_street2;
			$event_city      = $location->location_city;
			$event_state     = $location->location_state;
			$event_postcode  = $location->location_postcode;
			$event_region    = $location->location_region;
			$event_country   = $location->location_country;
			$event_url       = $location->location_url;
			$event_longitude = $location->location_longitude;
			$event_latitude  = $location->location_latitude;
			$event_zoom      = $location->location_zoom;
			$event_phone     = $location->location_phone;
			$event_access    = $location->location_access;
		} else {
			$event_label     = ! empty( $post['event_label'] ) ? $post['event_label'] : '';
			$event_street    = ! empty( $post['event_street'] ) ? $post['event_street'] : '';
			$event_street2   = ! empty( $post['event_street2'] ) ? $post['event_street2'] : '';
			$event_city      = ! empty( $post['event_city'] ) ? $post['event_city'] : '';
			$event_state     = ! empty( $post['event_state'] ) ? $post['event_state'] : '';
			$event_postcode  = ! empty( $post['event_postcode'] ) ? $post['event_postcode'] : '';
			$event_region    = ! empty( $post['event_region'] ) ? $post['event_region'] : '';
			$event_country   = ! empty( $post['event_country'] ) ? $post['event_country'] : '';
			$event_url       = ! empty( $post['event_url'] ) ? $post['event_url'] : '';
			$event_longitude = ! empty( $post['event_longitude'] ) ? $post['event_longitude'] : '';
			$event_latitude  = ! empty( $post['event_latitude'] ) ? $post['event_latitude'] : '';
			$event_zoom      = ! empty( $post['event_zoom'] ) ? $post['event_zoom'] : '';
			$event_phone     = ! empty( $post['event_phone'] ) ? $post['event_phone'] : '';
			$event_access    = ! empty( $post['event_access'] ) ? $post['event_access'] : array();
			$event_access    = ! empty( $post['event_access_hidden'] ) ? unserialize( $post['event_access_hidden'] ) : $event_access;
		}
		// We check to make sure the URL is acceptable (blank or starting with http://).
		if ( ! ( '' === $event_link || preg_match( '/^(http)(s?)(:)\/\//', $event_link ) ) ) {
			$event_link = 'http://' . $event_link;
		}
		// A title is required, and can't be more than 255 characters.
		$title_length = strlen( $title );
		if ( ! ( $title_length >= 1 &amp;&amp; $title_length &lt;= 255 ) ) {
			$title = __( 'Untitled Event', 'my-calendar' );
		}
		$proceed = true;
		$submit  = array(
			// Begin strings.
			'event_title'        => $title,
			'event_desc'         => $desc,
			'event_short'        => $short,
			'event_link'         => $event_link,
			'event_label'        => $event_label,
			'event_street'       => $event_street,
			'event_street2'      => $event_street2,
			'event_city'         => $event_city,
			'event_state'        => $event_state,
			'event_postcode'     => $event_postcode,
			'event_region'       => $event_region,
			'event_country'      => $event_country,
			'event_url'          => $event_url,
			'event_image'        => $event_image,
			'event_phone'        => $event_phone,
			'event_access'       => serialize( $event_access ),
			'event_tickets'      => $event_tickets,
			'event_registration' => $event_registration,
			// Begin integers.
			'event_category'     => $primary,
			'event_link_expires' => $expires,
			'event_zoom'         => $event_zoom,
			'event_host'         => $host,
			'event_span'         => $event_span,
			// Begin floats.
			'event_longitude'    => $event_longitude,
			'event_latitude'     => $event_latitude,
			// Array (not saved directly).
			'event_categories'   => $cats,
		);

		$submit = array_map( 'mc_kses_post', $submit );
		$data   = array( $proceed, false, $submit, $errors );
	} else {
		$proceed = false;
		$data    = array( $proceed, false, array(), __( 'Invalid Action', 'my-calendar' ) );
	}

	return $data;
}


/**
 * Used on the manage events admin page to display a list of events
 */
function mc_list_groups() {
	global $wpdb;
	$user = wp_get_current_user()->ID;

	$sortby = ( isset( $_GET['sort'] ) ) ? $_GET['sort'] : mc_get_option( 'default_sort' );
	if ( isset( $_GET['order'] ) ) {
		$sortdir = ( isset( $_GET['order'] ) &amp;&amp; 'ASC' === $_GET['order'] ) ? 'ASC' : 'default';
	} else {
		$sortdir = 'default';
	}
	if ( empty( $sortby ) ) {
		$sortbyvalue = 'event_begin';
	} else {
		switch ( $sortby ) {
			case '1':
				$sortbyvalue = 'event_ID';
				break;
			case '2':
				$sortbyvalue = 'event_title';
				break;
			case '3':
				$sortbyvalue = 'event_desc';
				break;
			case '4':
				$sortbyvalue = 'event_begin';
				break;
			case '5':
				$sortbyvalue = 'event_author';
				break;
			case '6':
				$sortbyvalue = 'event_category';
				break;
			case '7':
				$sortbyvalue = 'event_label';
				break;
			case '8':
				$sortbyvalue = 'group_id';
				break;
			default:
				$sortbyvalue = 'event_begin';
		}
	}
	$sortbydirection = ( 'default' === $sortdir ) ? 'DESC' : $sortdir;
	$sort            = ( 'DESC' === $sortbydirection ) ? 'ASC' : 'DESC';

	$current        = empty( $_GET['paged'] ) ? 1 : intval( $_GET['paged'] );
	$screen         = get_current_screen();
	$option         = $screen->get_option( 'per_page', 'option' );
	$items_per_page = get_user_meta( $user, $option, true );
	if ( empty( $items_per_page ) || $items_per_page &lt; 1 ) {
		$items_per_page = $screen->get_option( 'per_page', 'default' );
	}
	$limit = ( isset( $_GET['limit'] ) ) ? $_GET['limit'] : 'published';
	switch ( $limit ) {
		case 'published':
			$limit = 'WHERE event_approved != 2';
			break;
		case 'grouped':
			$limit = 'WHERE event_group_id &lt;> 0 AND event_approved != 2';
			break;
		case 'ungrouped':
			$limit = 'WHERE event_group_id = 0 AND event_approved != 2';
			break;
		default:
			$limit = '';
	}
	$query_limit = ( ( $current - 1 ) * $items_per_page );
	$events      = $wpdb->get_results( $wpdb->prepare( 'SELECT SQL_CALC_FOUND_ROWS * FROM ' . my_calendar_table() . " $limit ORDER BY $sortbyvalue $sortbydirection LIMIT %d, %d", $query_limit, $items_per_page ) ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared,WordPress.DB.PreparedSQL.NotPrepared
	$found_rows  = $wpdb->get_col( 'SELECT FOUND_ROWS();' );
	$items       = $found_rows[0];
	?>
	&lt;div class='inside'>
		&lt;div class="mc-admin-header">
		&lt;ul class="links">
			&lt;li>
				&lt;a &lt;?php echo ( isset( $_GET['limit'] ) &amp;&amp; 'grouped' === $_GET['limit'] ) ? ' class="active-link"' : ''; ?> href="&lt;?php echo admin_url( 'admin.php?page=my-calendar-manage&amp;groups=true&amp;amp;limit=grouped#my-calendar-admin-table' ); ?>">&lt;?php esc_html_e( 'Grouped Events', 'my-calendar' ); ?>&lt;/a>
			&lt;/li>
			&lt;li>
				&lt;a &lt;?php echo ( isset( $_GET['limit'] ) &amp;&amp; 'ungrouped' === $_GET['limit'] ) ? ' class="active-link"' : ''; ?> href="&lt;?php echo admin_url( 'admin.php?page=my-calendar-manage&amp;groups=true&amp;amp;limit=ungrouped#my-calendar-admin-table' ); ?>">&lt;?php esc_html_e( 'Ungrouped Events', 'my-calendar' ); ?>&lt;/a>
			&lt;/li>
			&lt;li>
				&lt;a &lt;?php echo ( isset( $_GET['limit'] ) &amp;&amp; 'all' === $_GET['limit'] || ! isset( $_GET['limit'] ) ) ? ' class="active-link"' : ''; ?> href="&lt;?php echo admin_url( 'admin.php?page=my-calendar-manage&amp;groups=true#my-calendar-admin-table' ); ?>">&lt;?php esc_html_e( 'All', 'my-calendar' ); ?>&lt;/a>
			&lt;/li>
		&lt;/ul>
	&lt;?php
	$num_pages = ceil( $items / $items_per_page );
	if ( $num_pages > 1 ) {
		$page_links = paginate_links(
			array(
				'base'      => add_query_arg( 'paged', '%#%' ),
				'format'    => '',
				'prev_text' => __( '&amp;laquo; Previous&lt;span class="screen-reader-text"> Events&lt;/span>', 'my-calendar' ),
				'next_text' => __( 'Next&lt;span class="screen-reader-text"> Events&lt;/span> &amp;raquo;', 'my-calendar' ),
				'total'     => $num_pages,
				'current'   => $current,
				'mid_size'  => 1,
			)
		);
		printf( "&lt;div class='tablenav'>&lt;div class='tablenav-pages'>%s&lt;/div>&lt;/div>", $page_links );
	}
	?>
		&lt;/div>
	&lt;?php
	if ( ! empty( $events ) ) {
		?>
		&lt;form action="&lt;?php echo admin_url( 'admin.php?page=my-calendar-manage&amp;groups=true' ); ?>" method="post">
			&lt;div>
				&lt;input type="hidden" name="_wpnonce" value="&lt;?php echo wp_create_nonce( 'my-calendar-nonce' ); ?>"/>
				&lt;input type="hidden" name="event_action" value="group"/>
			&lt;/div>
			&lt;p class="mc-group-buttons mc-actions">
				&lt;input type="submit" class="button-primary group" value="&lt;?php _e( 'Group events', 'my-calendar' ); ?>" />
			&lt;/p>
			&lt;table class="widefat wp-list-table mc-groups-table" id="my-calendar-admin-table">
				&lt;caption class="screen-reader-text">&lt;?php esc_html_e( 'Grouped Events list. Use column headers to sort.', 'my-calendar' ); ?>&lt;/caption>
				&lt;thead>
					&lt;tr>
						&lt;?php
						$admin_url = admin_url( "admin.php?page=my-calendar-manage&amp;groups=true&amp;order=$sort&amp;paged=$current" );
						$url       = add_query_arg( 'sort', '1', $admin_url );
						$col_head  = mc_table_header( __( 'ID', 'my-calendar' ), $sort, $sortby, '1', $url );
						$url       = add_query_arg( 'sort', '8', $admin_url );
						$col_head .= mc_table_header( __( 'Group', 'my-calendar' ), $sort, $sortby, '8', $url );
						$url       = add_query_arg( 'sort', '2', $admin_url );
						$col_head .= mc_table_header( __( 'Title', 'my-calendar' ), $sort, $sortby, '2', $url );
						$url       = add_query_arg( 'sort', '7', $admin_url );
						$col_head .= mc_table_header( __( 'Location', 'my-calendar' ), $sort, $sortby, '7', $url );
						$url       = add_query_arg( 'sort', '4', $admin_url );
						$col_head .= mc_table_header( __( 'Date/Time', 'my-calendar' ), $sort, $sortby, '4', $url );
						$url       = add_query_arg( 'sort', '5', $admin_url );
						$col_head .= mc_table_header( __( 'Author', 'my-calendar' ), $sort, $sortby, '5', $url );
						$url       = add_query_arg( 'sort', '6', $admin_url );
						$col_head .= mc_table_header( __( 'Category', 'my-calendar' ), $sort, $sortby, '6', $url );
						echo $col_head;
						?>
					&lt;/tr>
				&lt;/thead>
				&lt;?php
				$class = '';
				foreach ( $events as $event ) {
					$is_grouped = mc_event_is_grouped( $event->event_group_id );
					$class      = ( 'alternate' === $class ) ? 'even' : 'alternate';
					$spam       = ( '1' === $event->event_flagged ) ? ' spam' : '';
					$spam_label = ( '1' === $event->event_flagged ) ? '&lt;strong>Possible spam:&lt;/strong> ' : '';
					$author     = ( '0' !== $event->event_author ) ? get_userdata( $event->event_author ) : 'Public Submitter';
					$can_edit   = mc_can_edit_event( $event );
					if ( '' !== trim( $event->event_link ) ) {
						$title = "&lt;a href='" . esc_attr( $event->event_link ) . "'>" . strip_tags( $event->event_title, mc_strip_tags() ) . '&lt;/a>';
					} else {
						$title = $event->event_title;
					}
					?>
				&lt;tr class="&lt;?php echo "$class $spam"; ?>" id="event&lt;?php echo $event->event_id; ?>">
					&lt;th scope="row">
						&lt;input type="checkbox" aria-describedby="event_&lt;?php echo $event->event_id; ?>" value="&lt;?php echo $event->event_id; ?>" name="group[]" id="mc&lt;?php echo $event->event_id; ?>" &lt;?php echo ( $is_grouped ) ? ' disabled="disabled"' : ''; ?> />
						&lt;label for="mc&lt;?php echo $event->event_id; ?>">&lt;span class="screen-reader-text">&lt;?php esc_html_e( 'Group event', 'my-calendar' ); ?>&lt;/span>&lt;?php echo $event->event_id; ?>&lt;/label>
					&lt;/th>
					&lt;th scope="row">
						&lt;?php echo ( '0' === $event->event_group_id ) ? '-' : $event->event_group_id; ?>
					&lt;/th>
					&lt;td>
						&lt;strong>
						&lt;?php
						$edit_link = '';
						if ( $can_edit ) {
							if ( $is_grouped ) {
								$edit_link = admin_url( "admin.php?page=my-calendar-manage&amp;groups=true&amp;amp;mode=edit&amp;amp;event_id=$event->event_id&amp;amp;group_id=$event->event_group_id" );
							}
							if ( $edit_link ) {
								echo '&lt;a href="' . esc_url( $edit_link ) . '" class="edit">';
							}
						}
						echo $spam_label;
						echo '&lt;span id="event_' . $event->event_id . '">' . strip_tags( stripslashes( $title ) ) . '&lt;/span>';
						if ( $can_edit &amp;&amp; $edit_link ) {
							echo '&lt;/a>';
						}
						if ( ! $is_grouped ) {
							echo ' - &lt;em>' . __( 'Ungrouped', 'my-calendar' ) . '&lt;/em>';

						}
						?>
						&lt;/strong>

						&lt;div class='row-actions'>
							&lt;?php
							if ( $can_edit ) {
								?>
								&lt;a href="&lt;?php echo admin_url( "admin.php?page=my-calendar&amp;amp;mode=edit&amp;amp;event_id=$event->event_id" ); ?>" class='edit' aria-describedby='event_&lt;?php echo $event->event_id; ?>'>&lt;?php esc_html_e( 'Edit Event', 'my-calendar' ); ?>&lt;/a>
								&lt;?php
								if ( $is_grouped ) {
									?>
									| &lt;a href="&lt;?php echo admin_url( "admin.php?page=my-calendar-manage&amp;groups=true&amp;amp;mode=edit&amp;amp;event_id=$event->event_id&amp;amp;group_id=$event->event_group_id" ); ?>" class='edit group'>&lt;?php esc_html_e( 'Edit Group', 'my-calendar' ); ?>&lt;/a>
									&lt;?php
								}
							} else {
								_e( 'Not editable.', 'my-calendar' );
							}
							?>
						&lt;/div>
					&lt;/td>
					&lt;td>&lt;?php echo strip_tags( stripslashes( $event->event_label ) ); ?>&lt;/td>
					&lt;?php
					if ( '23:59:59' !== $event->event_endtime ) {
						$event_time = date_i18n( mc_time_format(), strtotime( $event->event_time ) );
					} else {
						$event_time = mc_notime_label( $event );
					}
					?>
					&lt;td>
					&lt;?php
						$begin = date_i18n( mc_date_format(), strtotime( $event->event_begin ) );
						echo esc_html( "$begin, $event_time" );
					?>
						&lt;div class="recurs">
							&lt;?php echo mc_recur_string( $event ); ?>
						&lt;/div>
					&lt;/td>
					&lt;td>&lt;?php echo ( is_object( $author ) ) ? $author->display_name : $author; ?>&lt;/td>
					&lt;td>
					&lt;?php echo mc_admin_category_list( $event ); ?>
					&lt;/td>
					&lt;/tr>
					&lt;?php
				}
				?>
			&lt;/table>
		&lt;div class="mc-controls footer">
			&lt;p class="mc-actions mc-group-buttons">
				&lt;input type="submit" class="button-primary group" value="&lt;?php _e( 'Group events', 'my-calendar' ); ?>"/>
			&lt;/p>
		&lt;/div>
		&lt;/form>
		&lt;?php
	} else {
		?>
		&lt;p class="mc-none">&lt;?php esc_html_e( 'No events found.', 'my-calendar' ); ?>&lt;/p>
		&lt;?php
	}
	echo '&lt;/div>';
}
</code></pre>
        </article>
    </section>




	</main>
    <footer>
		<a href="https://docs.joedolson.com/my-calendar">My Calendar User Documentation</a> &bull;
		<a href="https://github.com/joedolson/my-calendar/">My Calendar on GitHub</a> &bull;
		<a href="https://www.joedolson.com/my-calendar-pro/">Buy My Calendar Pro</a>
	</footer>

	
</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Actions</h3><ul><li><a href="mc_after_help.html">mc_after_help</a></li><li><a href="mc_bulk_actions.html">mc_bulk_actions</a></li><li><a href="mc_clean_duplicate_locations.html">mc_clean_duplicate_locations</a></li><li><a href="mc_create_location_posts.html">mc_create_location_posts</a></li><li><a href="mc_debug.html">mc_debug</a></li><li><a href="mc_delete_event.html">mc_delete_event</a></li><li><a href="mc_delete_event_instance.html">mc_delete_event_instance</a></li><li><a href="mc_delete_location.html">mc_delete_location</a></li><li><a href="mc_delete_location_posts.html">mc_delete_location_posts</a></li><li><a href="mc_deleted_post.html">mc_deleted_post</a></li><li><a href="mc_event_expired.html">mc_event_expired</a></li><li><a href="mc_event_future.html">mc_event_future</a></li><li><a href="mc_event_happening.html">mc_event_happening</a></li><li><a href="mc_event_over.html">mc_event_over</a></li><li><a href="mc_hide_past_dates.html">mc_hide_past_dates</a></li><li><a href="mc_mass_delete_locations.html">mc_mass_delete_locations</a></li><li><a href="mc_mass_%257B$action%257D_events.html">mc_mass_{$action}_events</a></li><li><a href="mc_modify_location.html">mc_modify_location</a></li><li><a href="mc_notify_event_spam.html">mc_notify_event_spam</a></li><li><a href="mc_post_add_category.html">mc_post_add_category</a></li><li><a href="mc_post_category_form.html">mc_post_category_form</a></li><li><a href="mc_print_view_head.html">mc_print_view_head</a></li><li><a href="mc_save_event.html">mc_save_event</a></li><li><a href="mc_save_grouped_events.html">mc_save_grouped_events</a></li><li><a href="mc_save_location.html">mc_save_location</a></li><li><a href="mc_save_settings.html">mc_save_settings</a></li><li><a href="mc_save_user.html">mc_save_user</a></li><li><a href="mc_tags_created.html">mc_tags_created</a></li><li><a href="mc_transition_event.html">mc_transition_event</a></li><li><a href="mc_update_event_post.html">mc_update_event_post</a></li><li><a href="mc_update_location_posts.html">mc_update_location_posts</a></li><li><a href="mcs_complete_submission.html">mcs_complete_submission</a></li><li><a href="my_calendar_drawing_event.html">my_calendar_drawing_event</a></li><li><a href="my_calendar_event_drawn.html">my_calendar_event_drawn</a></li></ul><h3>Filters</h3><ul><li><a href="ical_x_published_ttl.html">ical_x_published_ttl</a></li><li><a href="mc_access_selector.html">mc_access_selector</a></li><li><a href="mc_add_events_url.html">mc_add_events_url</a></li><li><a href="mc_adminbar_uri.html">mc_adminbar_uri</a></li><li><a href="mc_advanced_search.html">mc_advanced_search</a></li><li><a href="mc_after_calendar.html">mc_after_calendar</a></li><li><a href="mc_after_event.html">mc_after_event</a></li><li><a href="mc_after_event_no_details.html">mc_after_event_no_details</a></li><li><a href="mc_after_settings.html">mc_after_settings</a></li><li><a href="mc_ajax_js.html">mc_ajax_js</a></li><li><a href="mc_all_list_dates.html">mc_all_list_dates</a></li><li><a href="mc_api_auto_date.html">mc_api_auto_date</a></li><li><a href="mc_api_can_edit_event.html">mc_api_can_edit_event</a></li><li><a href="mc_api_key.html">mc_api_key</a></li><li><a href="mc_autoclose_comments.html">mc_autoclose_comments</a></li><li><a href="mc_before_calendar.html">mc_before_calendar</a></li><li><a href="mc_before_event.html">mc_before_event</a></li><li><a href="mc_before_event_form.html">mc_before_event_form</a></li><li><a href="mc_before_event_no_details.html">mc_before_event_no_details</a></li><li><a href="mc_before_save_insert.html">mc_before_save_insert</a></li><li><a href="mc_before_save_update.html">mc_before_save_update</a></li><li><a href="mc_cached_pages_to_refresh.html">mc_cached_pages_to_refresh</a></li><li><a href="mc_calendar_attributes.html">mc_calendar_attributes</a></li><li><a href="mc_can_edit_event.html">mc_can_edit_event</a></li><li><a href="mc_capabilities.html">mc_capabilities</a></li><li><a href="mc_category_fields.html">mc_category_fields</a></li><li><a href="mc_category_icon.html">mc_category_icon</a></li><li><a href="mc_category_key.html">mc_category_key</a></li><li><a href="mc_category_list.html">mc_category_list</a></li><li><a href="mc_category_selector.html">mc_category_selector</a></li><li><a href="mc_close_button.html">mc_close_button</a></li><li><a href="mc_convert_locations_select_to_autocomplete.html">mc_convert_locations_select_to_autocomplete</a></li><li><a href="mc_custom_content_editor.html">mc_custom_content_editor</a></li><li><a href="mc_custom_dirs.html">mc_custom_dirs</a></li><li><a href="mc_custom_sidebar_panels.html">mc_custom_sidebar_panels</a></li><li><a href="mc_custom_spam_status.html">mc_custom_spam_status</a></li><li><a href="mc_custom_template.html">mc_custom_template</a></li><li><a href="mc_custom_user_select.html">mc_custom_user_select</a></li><li><a href="mc_customize_details_link.html">mc_customize_details_link</a></li><li><a href="mc_customize_email_headers.html">mc_customize_email_headers</a></li><li><a href="mc_date_format.html">mc_date_format</a></li><li><a href="mc_datepicker_html.html">mc_datepicker_html</a></li><li><a href="mc_datetime_inputs.html">mc_datetime_inputs</a></li><li><a href="mc_default_event_length.html">mc_default_event_length</a></li><li><a href="mc_default_image_size.html">mc_default_image_size</a></li><li><a href="mc_default_options.html">mc_default_options</a></li><li><a href="mc_default_output_order.html">mc_default_output_order</a></li><li><a href="mc_details_grid_link.html">mc_details_grid_link</a></li><li><a href="mc_details_template.html">mc_details_template</a></li><li><a href="mc_disable_link.html">mc_disable_link</a></li><li><a href="mc_disable_mobile_js.html">mc_disable_mobile_js</a></li><li><a href="mc_disable_spam_checking.html">mc_disable_spam_checking</a></li><li><a href="mc_display_author.html">mc_display_author</a></li><li><a href="mc_display_css_on_archives.html">mc_display_css_on_archives</a></li><li><a href="mc_display_format.html">mc_display_format</a></li><li><a href="mc_display_host.html">mc_display_host</a></li><li><a href="mc_display_location_events.html">mc_display_location_events</a></li><li><a href="mc_draw_todays_event.html">mc_draw_todays_event</a></li><li><a href="mc_draw_upcoming_event.html">mc_draw_upcoming_event</a></li><li><a href="mc_event_access_choices.html">mc_event_access_choices</a></li><li><a href="mc_event_access_fields.html">mc_event_access_fields</a></li><li><a href="mc_event_category_slug.html">mc_event_category_slug</a></li><li><a href="mc_event_classes.html">mc_event_classes</a></li><li><a href="mc_event_content.html">mc_event_content</a></li><li><a href="mc_event_controls.html">mc_event_controls</a></li><li><a href="mc_event_detail_%257Bname%257D.html">mc_event_detail_{name}</a></li><li><a href="mc_event_details.html">mc_event_details</a></li><li><a href="mc_event_exclude_from_search.html">mc_event_exclude_from_search</a></li><li><a href="mc_event_expired_link.html">mc_event_expired_link</a></li><li><a href="mc_event_has_alarm.html">mc_event_has_alarm</a></li><li><a href="mc_event_image_alt.html">mc_event_image_alt</a></li><li><a href="mc_event_mail_bcc.html">mc_event_mail_bcc</a></li><li><a href="mc_event_mail_body.html">mc_event_mail_body</a></li><li><a href="mc_event_mail_from.html">mc_event_mail_from</a></li><li><a href="mc_event_mail_subject.html">mc_event_mail_subject</a></li><li><a href="mc_event_mail_to.html">mc_event_mail_to</a></li><li><a href="mc_event_notices.html">mc_event_notices</a></li><li><a href="mc_event_object.html">mc_event_object</a></li><li><a href="mc_event_post_content.html">mc_event_post_content</a></li><li><a href="mc_event_recur_string.html">mc_event_recur_string</a></li><li><a href="mc_event_registration.html">mc_event_registration</a></li><li><a href="mc_event_registration_form.html">mc_event_registration_form</a></li><li><a href="mc_event_saved_message.html">mc_event_saved_message</a></li><li><a href="mc_event_schema.html">mc_event_schema</a></li><li><a href="mc_event_slug.html">mc_event_slug</a></li><li><a href="mc_event_statuses.html">mc_event_statuses</a></li><li><a href="mc_event_title.html">mc_event_title</a></li><li><a href="mc_event_today.html">mc_event_today</a></li><li><a href="mc_event_upcoming.html">mc_event_upcoming</a></li><li><a href="mc_event_upcoming_after.html">mc_event_upcoming_after</a></li><li><a href="mc_event_upcoming_before.html">mc_event_upcoming_before</a></li><li><a href="mc_excerpt_length.html">mc_excerpt_length</a></li><li><a href="mc_expand.html">mc_expand</a></li><li><a href="mc_fields_required.html">mc_fields_required</a></li><li><a href="mc_file_exists.html">mc_file_exists</a></li><li><a href="mc_filter_admin_grid_args.html">mc_filter_admin_grid_args</a></li><li><a href="mc_filter_api_args.html">mc_filter_api_args</a></li><li><a href="mc_filter_day.html">mc_filter_day</a></li><li><a href="mc_filter_events.html">mc_filter_events</a></li><li><a href="mc_filter_ical_template.html">mc_filter_ical_template</a></li><li><a href="mc_filter_image_data.html">mc_filter_image_data</a></li><li><a href="mc_filter_location_list.html">mc_filter_location_list</a></li><li><a href="mc_filter_location_results.html">mc_filter_location_results</a></li><li><a href="mc_filter_month.html">mc_filter_month</a></li><li><a href="mc_filter_offset.html">mc_filter_offset</a></li><li><a href="mc_filter_shortcodes.html">mc_filter_shortcodes</a></li><li><a href="mc_filter_year.html">mc_filter_year</a></li><li><a href="mc_footer_navigation.html">mc_footer_navigation</a></li><li><a href="mc_format_toggle_html.html">mc_format_toggle_html</a></li><li><a href="mc_from_date.html">mc_from_date</a></li><li><a href="mc_future_search_results.html">mc_future_search_results</a></li><li><a href="mc_gcal_description.html">mc_gcal_description</a></li><li><a href="mc_gcal_location.html">mc_gcal_location</a></li><li><a href="mc_generator_tab_content.html">mc_generator_tab_content</a></li><li><a href="mc_generator_tabs.html">mc_generator_tabs</a></li><li><a href="mc_get_current_url.html">mc_get_current_url</a></li><li><a href="mc_get_events_sites.html">mc_get_events_sites</a></li><li><a href="mc_get_file.html">mc_get_file</a></li><li><a href="mc_get_uri.html">mc_get_uri</a></li><li><a href="mc_get_week_days.html">mc_get_week_days</a></li><li><a href="mc_gmap_html.html">mc_gmap_html</a></li><li><a href="mc_grid_date.html">mc_grid_date</a></li><li><a href="mc_grid_day_wrapper.html">mc_grid_day_wrapper</a></li><li><a href="mc_grid_header_wrapper.html">mc_grid_header_wrapper</a></li><li><a href="mc_grid_js.html">mc_grid_js</a></li><li><a href="mc_grid_week_wrapper.html">mc_grid_week_wrapper</a></li><li><a href="mc_grid_wrapper.html">mc_grid_wrapper</a></li><li><a href="mc_grouped_events.html">mc_grouped_events</a></li><li><a href="mc_groups_pre_checkdata.html">mc_groups_pre_checkdata</a></li><li><a href="mc_happening_next_template.html">mc_happening_next_template</a></li><li><a href="mc_has_feeds.html">mc_has_feeds</a></li><li><a href="mc_hcard.html">mc_hcard</a></li><li><a href="mc_header_navigation.html">mc_header_navigation</a></li><li><a href="mc_heading.html">mc_heading</a></li><li><a href="mc_heading_inner_title.html">mc_heading_inner_title</a></li><li><a href="mc_heading_level.html">mc_heading_level</a></li><li><a href="mc_heading_level_list.html">mc_heading_level_list</a></li><li><a href="mc_heading_level_table.html">mc_heading_level_table</a></li><li><a href="mc_hide_nextmonth.html">mc_hide_nextmonth</a></li><li><a href="mc_ical_attributes.html">mc_ical_attributes</a></li><li><a href="mc_ical_download_from.html">mc_ical_download_from</a></li><li><a href="mc_ical_download_to.html">mc_ical_download_to</a></li><li><a href="mc_imported_event.html">mc_imported_event</a></li><li><a href="mc_include_today_in_total.html">mc_include_today_in_total</a></li><li><a href="mc_inner_content.html">mc_inner_content</a></li><li><a href="mc_inner_content_template_fields.html">mc_inner_content_template_fields</a></li><li><a href="mc_insert_author_data.html">mc_insert_author_data</a></li><li><a href="mc_insert_custom_fields.html">mc_insert_custom_fields</a></li><li><a href="mc_insert_recurring.html">mc_insert_recurring</a></li><li><a href="mc_instance_data.html">mc_instance_data</a></li><li><a href="mc_instance_format.html">mc_instance_format</a></li><li><a href="mc_jumpbox.html">mc_jumpbox</a></li><li><a href="mc_jumpbox_future_years.html">mc_jumpbox_future_years</a></li><li><a href="mc_legacy_templates_enabled.html">mc_legacy_templates_enabled</a></li><li><a href="mc_list_event_title_hint.html">mc_list_event_title_hint</a></li><li><a href="mc_list_js.html">mc_list_js</a></li><li><a href="mc_list_titles_separator.html">mc_list_titles_separator</a></li><li><a href="mc_location_access_choices.html">mc_location_access_choices</a></li><li><a href="mc_location_container_primary.html">mc_location_container_primary</a></li><li><a href="mc_location_container_secondary.html">mc_location_container_secondary</a></li><li><a href="mc_location_events_link.html">mc_location_events_link</a></li><li><a href="mc_location_exclude_from_search.html">mc_location_exclude_from_search</a></li><li><a href="mc_location_fields.html">mc_location_fields</a></li><li><a href="mc_location_limit_sql.html">mc_location_limit_sql</a></li><li><a href="mc_location_list.html">mc_location_list</a></li><li><a href="mc_location_manager_cells.html">mc_location_manager_cells</a></li><li><a href="mc_location_manager_headers.html">mc_location_manager_headers</a></li><li><a href="mc_location_output.html">mc_location_output</a></li><li><a href="mc_location_schema.html">mc_location_schema</a></li><li><a href="mc_location_selector.html">mc_location_selector</a></li><li><a href="mc_map_height.html">mc_map_height</a></li><li><a href="mc_map_html.html">mc_map_html</a></li><li><a href="mc_map_icon.html">mc_map_icon</a></li><li><a href="mc_map_label.html">mc_map_label</a></li><li><a href="mc_map_url.html">mc_map_url</a></li><li><a href="mc_map_width.html">mc_map_width</a></li><li><a href="mc_mini_js.html">mc_mini_js</a></li><li><a href="mc_month_format.html">mc_month_format</a></li><li><a href="mc_month_year_format.html">mc_month_year_format</a></li><li><a href="mc_next_link.html">mc_next_link</a></li><li><a href="mc_notime_label.html">mc_notime_label</a></li><li><a href="mc_order_location_fields.html">mc_order_location_fields</a></li><li><a href="mc_override_category_icon.html">mc_override_category_icon</a></li><li><a href="mc_override_featured_image.html">mc_override_featured_image</a></li><li><a href="mc_past_search_results.html">mc_past_search_results</a></li><li><a href="mc_phone_format.html">mc_phone_format</a></li><li><a href="mc_post_template.html">mc_post_template</a></li><li><a href="mc_post_thumbnail_atts.html">mc_post_thumbnail_atts</a></li><li><a href="mc_pre_add_category.html">mc_pre_add_category</a></li><li><a href="mc_pre_checkdata.html">mc_pre_checkdata</a></li><li><a href="mc_prev_link.html">mc_prev_link</a></li><li><a href="mc_primary_sort.html">mc_primary_sort</a></li><li><a href="mc_print_return_url.html">mc_print_return_url</a></li><li><a href="mc_private_categories.html">mc_private_categories</a></li><li><a href="mc_private_event.html">mc_private_event</a></li><li><a href="mc_process_shortcodes.html">mc_process_shortcodes</a></li><li><a href="mc_registered_stylesheet.html">mc_registered_stylesheet</a></li><li><a href="mc_registration_state.html">mc_registration_state</a></li><li><a href="mc_related_event_limit.html">mc_related_event_limit</a></li><li><a href="mc_related_template.html">mc_related_template</a></li><li><a href="mc_return_to_calendar.html">mc_return_to_calendar</a></li><li><a href="mc_return_uri.html">mc_return_uri</a></li><li><a href="mc_rss_feed_date_range.html">mc_rss_feed_date_range</a></li><li><a href="mc_search_after.html">mc_search_after</a></li><li><a href="mc_search_attributes.html">mc_search_attributes</a></li><li><a href="mc_search_before.html">mc_search_before</a></li><li><a href="mc_search_exportlinks.html">mc_search_exportlinks</a></li><li><a href="mc_search_fields.html">mc_search_fields</a></li><li><a href="mc_search_no_results.html">mc_search_no_results</a></li><li><a href="mc_search_page.html">mc_search_page</a></li><li><a href="mc_search_template.html">mc_search_template</a></li><li><a href="mc_searched_events.html">mc_searched_events</a></li><li><a href="mc_secondary_sort.html">mc_secondary_sort</a></li><li><a href="mc_send_notification.html">mc_send_notification</a></li><li><a href="mc_set_primary_category.html">mc_set_primary_category</a></li><li><a href="mc_settings_section_links.html">mc_settings_section_links</a></li><li><a href="mc_setup_allowed_sites.html">mc_setup_allowed_sites</a></li><li><a href="mc_shortcode_generator.html">mc_shortcode_generator</a></li><li><a href="mc_show_block.html">mc_show_block</a></li><li><a href="mc_show_custom_posts_in_menu.html">mc_show_custom_posts_in_menu</a></li><li><a href="mc_show_months.html">mc_show_months</a></li><li><a href="mc_show_week_number.html">mc_show_week_number</a></li><li><a href="mc_single_event_shortcode.html">mc_single_event_shortcode</a></li><li><a href="mc_single_event_title.html">mc_single_event_title</a></li><li><a href="mc_single_ical_template.html">mc_single_ical_template</a></li><li><a href="mc_skip_search_results.html">mc_skip_search_results</a></li><li><a href="mc_subheading_level.html">mc_subheading_level</a></li><li><a href="mc_template.html">mc_template</a></li><li><a href="mc_text_all_categories.html">mc_text_all_categories</a></li><li><a href="mc_time_max.html">mc_time_max</a></li><li><a href="mc_time_min.html">mc_time_min</a></li><li><a href="mc_time_toggle_html.html">mc_time_toggle_html</a></li><li><a href="mc_titles_format.html">mc_titles_format</a></li><li><a href="mc_to_date.html">mc_to_date</a></li><li><a href="mc_today_attributes.html">mc_today_attributes</a></li><li><a href="mc_today_link.html">mc_today_link</a></li><li><a href="mc_todays_events_after.html">mc_todays_events_after</a></li><li><a href="mc_todays_events_before.html">mc_todays_events_before</a></li><li><a href="mc_todays_events_header.html">mc_todays_events_header</a></li><li><a href="mc_upcoming_attributes.html">mc_upcoming_attributes</a></li><li><a href="mc_upcoming_date_from.html">mc_upcoming_date_from</a></li><li><a href="mc_upcoming_date_to.html">mc_upcoming_date_to</a></li><li><a href="mc_upcoming_events_footer.html">mc_upcoming_events_footer</a></li><li><a href="mc_upcoming_events_header.html">mc_upcoming_events_header</a></li><li><a href="mc_upcoming_events_template.html">mc_upcoming_events_template</a></li><li><a href="mc_update_group_data.html">mc_update_group_data</a></li><li><a href="mc_use_avatars.html">mc_use_avatars</a></li><li><a href="mc_use_custom_template.html">mc_use_custom_template</a></li><li><a href="mc_use_permalinks.html">mc_use_permalinks</a></li><li><a href="mc_user_can_see_private_events.html">mc_user_can_see_private_events</a></li><li><a href="mc_user_fields.html">mc_user_fields</a></li><li><a href="mc_user_permissions.html">mc_user_permissions</a></li><li><a href="mc_venue_accessibility.html">mc_venue_accessibility</a></li><li><a href="mc_widget_defaults.html">mc_widget_defaults</a></li><li><a href="mcs_check_conflicts.html">mcs_check_conflicts</a></li><li><a href="mcs_submission_permissions.html">mcs_submission_permissions</a></li><li><a href="mcs_time_block.html">mcs_time_block</a></li><li><a href="mcs_view_admin_links_on_frontend.html">mcs_view_admin_links_on_frontend</a></li><li><a href="my_calendar_body.html">my_calendar_body</a></li><li><a href="my_calendar_events_args.html">my_calendar_events_args</a></li></ul>
</nav>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
